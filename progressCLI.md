#  Issues found

| ID    | Issue & steps to reproduce                                                                                                                                                                                                                                                                                                                                                                                        | Expected behaviour (from PRD)                                                                                                                                                                                                    | Actual behaviour                                                                                                                                                                                                                                                        |                                                                                                                          |                                                                                                                                                            |
| ----- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1** | **Unable to start a battle**. Navigate to the Classic Battle CLI page and choose a match length (Quick/Medium/Long) via the modal. After selecting “Quick” (either by clicking the button or pressing `1`), the modal closes but the game never advances to round 1. The “Round 0 of 0” header never updates and the stat cards remain empty.                                                                     | Selecting a round length should start the battle by dispatching the engine’s `startClicked` event. The header should show “Round 1 of N”, a timer should begin counting down and the player should be prompted to choose a stat. | The win‑target dropdown is updated (e.g., to 5 for “Quick”), but no timer appears and the stat list remains inactive. Clicking the yellow power icon or pressing `Enter/Space` does nothing. The game is effectively stuck at the pre‑start state and cannot be played. |                                                                                                                          |                                                                                                                                                            |
| **2** | **Overlapping modal text in stat area**. After choosing a match length, text from the round‑select modal (“First to 5 points wins.”) persists in the second stat column and overlaps the label “\[2] Speed”.                                                                                                                                                                                                      | Once the modal is closed, its elements should be removed from the DOM so that the stat list displays cleanly.                                                                                                                    | The leftover text reduces readability and suggests that the modal cleanup logic is incomplete.                                                                                                                                                                          |                                                                                                                          |                                                                                                                                                            |
| **3** | **“Invalid key” error shown when it shouldn’t**. When the game is idle (no round started) or when editing the seed input, pressing any of the keys defined for game controls (e.g., `1`–`5`, `Enter`, `Space`) displays an “Invalid key, press H for help” warning. This also happens while entering digits into the seed field; typing “456” triggers the warning even though the user is focusing the text box. | Input should be debounced per state: stat‑selection keys should be ignored silently before a round starts, and typing in form fields should not trigger global key‑handlers.                                                     | The application shows error messages even during normal input, leading to confusing feedback.                                                                                                                                                                           |                                                                                                                          |                                                                                                                                                            |
| **4** | **Scoreboard rendering issues**. The header displays “Round 0 of 0” and duplicates of the round/score information (“Round 0”, “You: 0 Opponent: 0”) due to overlapping elements. On a mid‑sized screen the text overflows and is truncated by other elements.                                                                                                                                                     | The PRD’s wireframe specifies a header that cleanly shows “Classic Battle – CLI                                                                                                                                                  |  Round X of Y                                                                                                                                                                                                                                                           |  You: N CPU: M”.  Only one instance of each data point should be visible, and it should not overlap other UI components. | The scoreboard appears twice and misaligns with the grid; this suggests that redundant nodes or hidden scoreboard elements are being rendered incorrectly. |
| **5** | **Timer and stat values never appear**. Because the battle never starts, the countdown timer (`⏱ Timer: 07s`) and the numeric values for each stat (“Power 8”, etc.) are never rendered.                                                                                                                                                                                                                          | Each round should display a 1 Hz countdown timer and the five stats with their numeric values, enabling players to choose a stat within the time limit.                                                                          | The UI remains in a skeleton state with blank stat fields, no countdown and no comparison results.                                                                                                                                                                      |                                                                                                                          |                                                                                                                                                            |
| **6** | **Accessibility shortcomings**. The only element with `aria-live` appears to be the round result message; the timer element (`#cli-countdown`) lacks an `aria-live` attribute, and the scoreboard uses `aria-live="off"`.  Screen‑reader users therefore may not hear timer updates.                                                                                                                              | The PRD requires that prompts, timers and outcomes be announced via ARIA live regions, with logical focus order and visible focus rings.                                                                                         | Timer updates are not exposed as live announcements.  Additionally, pressing `1`–`5` does not move focus to the stat list (it only highlights the card via mouse).                                                                                                      |                                                                                                                          |                                                                                                                                                            |
| **7** | **Seed entry still triggers global shortcuts**. When typing into the seed input, the global key listener treats each digit as a stat‑selection key and displays “Invalid key” warnings.                                                                                                                                                                                                                           | When a form control has focus, keyboard input should be routed only to that control.                                                                                                                                             | The conflict suggests that the keydown handler isn’t checking `e.target` or `e.isComposing` before acting.                                                                                                                                                              |                                                                                                                          |                                                                                                                                                            |
| **8** | **Verbose mode unavailable**. The PRD mentions a verbose log panel controlled by a feature flag `cliVerbose`.  Ticking the “Verbose” checkbox does not display any log panel; there is no visible way to view engine events or timers.                                                                                                                                                                            | Activating verbose mode should show a scrollable log of events with timestamps and update it as the battle progresses.                                                                                                           | The checkbox toggles state but has no apparent effect.                                                                                                                                                                                                                  |                                                                                                                          |                                                                                                                                                            |

 Improvement opportunities
Fix battle start – ensure that selecting a match length invokes startRound/startCallback correctly so the engine transitions into round 1. Verify that the modal’s keyboard handler attaches to the correct context and that the createRoundSelectModal cleanup removes all leftover nodes. Provide an explicit “Start Match” button as a fallback when automatic start fails.
Clean up modal artifacts – after closing the round‑select modal, remove all text and nodes inserted into the stat list. Use a dedicated container for modal content rather than injecting text into .cli-stat elements.
Improve key handling – gate all keyboard shortcuts on the current state. Ignore stat‑selection keys before a round starts and when an input field (seed entry) or modal is focused. Consider debouncing repeated key presses as specified in the PRD.
Consolidate scoreboard – refactor the header markup so that only one scoreboard element is rendered. Use flex layout to allocate fixed width to the round counter, win target and scores to prevent overflow. When the number of rounds changes, ensure the header updates correctly.
Implement timer and stat rendering – after the battle starts, fetch the player’s and opponent’s judoka stats and display them in the stat list. Show a 1 Hz countdown in the designated timer element and update data‑remaining‑time attributes for test hooks.
Enhance accessibility – set aria-live="polite" or assertive on the countdown timer and score displays so screen readers announce updates. Use role="status" on outcome messages and ensure focus moves appropriately after state changes. Provide visible focus rings on interactive elements.
Verbose logging – implement the verbose panel promised in the PRD: when Verbose is enabled, append a scrollable log showing timestamped transitions (start, stat selected, result) and expose it via an ARIA region for assistive technologies.
Test hooks – expose stable selectors (#cli-root, #cli-countdown, #cli-score, etc.) and data attributes (data-round, data-remaining-time) as per the PRD. This will facilitate automation and deterministic testing.
Keyboard focus management – after any modal closes, set focus appropriately (e.g., back to the stat list). Ensure Tab order follows the logical reading order defined in the PRD.
