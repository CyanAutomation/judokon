QA Report for src/pages/battleCLI.html

| Issue                                                     | Steps to reproduce                                                                                                                                                                                                                                                                           | Notes / Severity                                                                                                                                                                                                                                                                |
| --------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Win target setting does not persist or apply properly** | 1. On the Round 0 settings panel, change the “Win target” dropdown to 3 or 10. 2. Start the match by selecting a stat or pressing Enter. 3. Observe that the header still shows “Round 0 Target: 10” and the scoreboard resets to default “to 5” target; the setting reverts to 5 on reload. | The PRD states that the win target should persist via `localStorage`. Currently the selection reverts to 5 and does not reflect in the header, so players cannot set shorter or longer matches. Severity: **High** because it breaks a P2 requirement.                          |
| **Verbose/observability mode missing**                    | 1. Enable the “Verbose” checkbox in the settings panel or load the page with `?cliVerbose=1`. 2. Play several rounds. 3. No log pane appears; there is no display of timestamps or state transitions.                                                                                        | The PRD requires an observability mode/verbose pane with timestamped transitions. Its absence reduces testability and does not meet the “Verbose log view echoing transitions and events” requirement. Severity: **High**.                                                      |
| **ESC does not close the help overlay**                   | 1. During a round, press `H` to open the help overlay. 2. Press `Esc`. 3. Instead of closing, a hint “Invalid key, press H for help” appears and the overlay remains open.                                                                                                                   | The accessibility requirements specify that ESC should close modals. This bug prevents keyboard‑only users from quickly dismissing the help overlay. Severity: **Medium**.                                                                                                      |
| **Win target not shown while playing**                    | Once the match starts, the header displays only `Round X` and the scoreboard; it does not include the target (e.g., “Round 1 of 5”).                                                                                                                                                         | The PRD’s round context requirement calls for the header to show “Round X of N” (with win target). Omission reduces clarity. Severity: **Medium**.                                                                                                                              |
| **Help overlay does not pause timer**                     | Press `H` during a round to view the help panel. The round timer continues counting down in the background.                                                                                                                                                                                  | While not explicitly forbidden, the PRD emphasises that timers should pause when the tab is hidden or during interruptions. Pausing the timer during help would improve fairness, especially for screen‑reader users who need more time to read the overlay. Severity: **Low**. |
| **No warning colour change as timer approaches expiry**   | The PRD lists a warning colour (#ffcc00) for the timer when nearly expired. In testing, the timer remained a consistent colour and did not change to warn the player.                                                                                                                        | This is a minor aesthetic/UX issue but reduces adherence to the specification. Severity: **Low**.                                                                                                                                                                               |
| **Verbose toggle automatically starts match**             | Interacting with the settings dropdown or seed input instantly starts the round. There is no separate “start match” action, making it easy to start accidentally while adjusting settings.                                                                                                   | The PRD implies that players can adjust settings before starting. This behaviour might be confusing, though it may be by design. Severity: **Low**.                                                                                                                             |
| **Accessibility for screen‑readers unverified**           | Without code access, we could not confirm if aria‑live regions announce prompts, timers and outcomes. Visually there is no screen‑reader announcement indicator.                                                                                                                             | This is a risk: failing to implement these hooks would violate WCAG compliance. Severity: **Unknown**.                                                                                                                                                                          |

Improvement opportunities
Implement verbose log panel: Add a collapsible log area that echoes state transitions, timer ticks and selections with timestamps. Ensure it can be toggled with a feature flag (cliVerbose) and persists to assist testers and automation.
Persist win target via localStorage: Store the chosen win target and seed so that they remain across reloads. Update the header to display “Round X of N” so players know the match length.
Allow true pre‑game configuration: Delay the start of the match until the player presses a dedicated “Start” or Enter, preventing accidental starts when adjusting settings.
Fix ESC handling: Ensure the help/quit overlays listen for Esc key to close, satisfying accessibility requirements.
Pause timer when help is open: Consider pausing the round timer while the help overlay is visible, or at least extend the time after closing to offset time lost reading instructions.
Add timer warning colour: Change the countdown text to the specified warning colour (#ffcc00) when fewer than 5 seconds remain, as described in the enhancements.
Improve ARIA and screen‑reader support: Verify that all dynamic messages (timer updates, stat prompts, outcomes) are announced via aria-live regions. Add appropriate roles (e.g., status, timer) and ensure focus management for keyboard‑only and screen‑reader users.
Expose test hooks: Provide stable IDs (#cli-root, #cli-countdown, data-round, data-remaining-time) and consider adding a debug flag to output machine‑readable logs to the console for automation, as per the observability requirements.
Support ESC to cancel quit confirmation: In the quit dialog, allow pressing Esc as an alternative to clicking “Cancel”.
Clarify instructions: Add a quick note near the seed input explaining its purpose (deterministic replays) and mention that the verbose checkbox requires a query flag to enable the log panel.
