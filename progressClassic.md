QA report for src/pages/battleClassic.html

| Issue                                                          | Steps to reproduce                                                                                                                                                                                                                                                                                | Expected vs. actual behaviour                                                                                                                                                                                                                                                                   |
| -------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1. Mismatch in win‑target options**                          | Start the game and observe the “Select Match Length” modal.  The buttons are labelled **Quick**, **Medium** and **Long**.  Hovering over **Quick** shows a tooltip “First to 5 points wins.”                                                                                                      | The PRD specifies that players should choose between **3, 5 or 10 points**.  “Quick” implies 3 points, but the tooltip shows 5.  There is no option for 3 points, and the UI never mentions the exact targets for Medium/Long.  This misalignment makes it unclear what each length represents. |
| **2. Scoreboard not resetting on replay**                      | After finishing or quitting a match, click **Replay** to start a new game.  The new match begins at Round 1, but the score bar at the top sometimes displays the old score (e.g., “You: 3 Opponent: 1”) even though the match just started.                                                       | The scores should reset to 0–0 whenever a new match starts.  Retaining old scores is confusing and makes the scoreboard inaccurate.                                                                                                                                                             |
| **3. Game hangs after some rounds**                            | During play, after a few rounds (observed around Round 6), the timer reaches 0 s and all stat buttons are greyed out, but the next round does not start.  The “Next” button is disabled and waiting does not progress the game.                                                                   | After `roundResolved`, a 3‑s cooldown should begin and then the next `roundStarted` event should fire automatically.  Instead the UI becomes stuck, forcing the player to click **Replay** or refresh.                                                                                          |
| **4. Incorrect final score when quitting**                     | Start a match and immediately click **Quit**.  Confirm quitting.  The **Match Over** modal shows “You quit the match. You lose! (3–3)” even though no rounds were played.                                                                                                                         | Since no rounds were played, the end modal should show a 0–0 score and indicate that the player quit without a winner.                                                                                                                                                                          |
| **5. Missing outcome messages and inconsistent round counter** | On some selections the outcome message (“You picked …”) does not appear until after the next round begins, and sometimes the round counter jumps multiple numbers (e.g., from Round 1 to Round 3).                                                                                                | Outcome messages should display immediately upon resolution (shown via snackbar) and the round counter should increment sequentially.                                                                                                                                                                                |
| **6. Medium/Long match lengths lack description**              | Selecting “Medium” or “Long” using number keys starts a match but does not display a snackbar indicating the target points (unlike Quick mode which shows “First to 5 points”).                                                                                                                   | Each match‑length option should clearly communicate the win target to the player to satisfy the goal of clear rules.                                                                                                                                                                            |
| **7. Card & stat contrast**                                    | The stat buttons are red on light grey backgrounds; when disabled they become grey on grey.  Some text (e.g., white text on red buttons) may not meet WCAG 4.5:1 contrast ratio, and the disabled buttons look similar to the enabled ones (slightly lighter grey) making state hard to perceive. | The PRD requires ≥ 4.5:1 contrast and clear differentiation between enabled and disabled states.                                                                                                                                                                                                |
| **8. Accessibility description missing for stat buttons**      | The HTML source shows `aria‑describedby` is expected for each stat button, but dynamically generated buttons do not include descriptions or tooltips.  Screen‑reader users might not hear explanations of what each stat represents.                                                              | Each stat button should have an `aria-describedby` attribute linking to a short description to improve accessibility as required.                                                                                                                                                               |
| **9. Timer drift detection not implemented**                   | The PRD specifies that if the timer drifts by more than 2 s, the UI should display “Waiting…” via a snackbar and reset.  No drift detection or waiting message was observed during testing.                                                                                                                      | Implement drift detection and show the waiting message when required.                                                                                                                                                                  

Improvement opportunities
Clarify match length options. Rename “Quick”, “Medium” and “Long” to explicitly show the win target (e.g., “3 Points (Quick)”, “5 Points (Standard)”, “10 Points (Long)”) and fix the tooltip for Quick to reflect 3 points. When a player selects an option, display a snackbar like “First to 3 points wins” so the goal is always visible.
Ensure state resets on replay. When the user clicks Replay, reset all internal counters (round, scores, stat selection timer) and hide any persistent tooltips. This prevents stale scores from appearing at the beginning of a new match.
Fix inter‑round hang bug. Investigate the state machine around roundResolved and the inter‑round cooldown. The game sometimes fails to dispatch the next roundStarted event after the cooldown, leaving the UI disabled. Adding logging hooks or exposing the battle state progress list via the battleStateProgress feature flag could help identify where state transitions stall.
Accurate end‑of‑match scoring. When a player quits early, compute the final score based on actual rounds played, not leftover values from previous matches. The quit modal should show the current score (e.g., 0–0 if no rounds played).
Improve outcome messaging timing. Display the “You picked X — Opponent picked Y” message via a snackbar, immediately after both values are revealed. Ensure the round counter increments correctly and resets on new matches.
Enhance visual contrast. Adjust colors of enabled/disabled stat buttons to meet WCAG 4.5:1 contrast requirements. Consider using different hues or patterns for disabled states to improve readability for colour‑blind users.
Add aria descriptions for stat buttons. Provide aria-describedby attributes that point to hidden labels describing each stat (e.g., “Speed: how fast the judoka moves”). This satisfies the accessibility requirement for screen‑reader users.
Implement timer‑drift handling. Compare the countdown timer to real time and, if drift exceeds 2 s, display a “Waiting…” message via snackbar and synchronise the timer as specified.
Make match length persistence configurable. Decide whether the selected win target should persist across matches. Persisting might confuse new users when they expect to select again; adding a toggle or resetting to default would align with user expectations.
Add test/automation hooks. Implement the enableTestMode, battleStateProgress and skipRoundCooldown feature flags as described. This would allow QA scripts to simulate matches without delays, view state progressions and reproduce bugs deterministically. Expose a seed control to make random draws reproducible.
