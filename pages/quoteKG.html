<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="keywords" content="judo, card game, web game, judoka" />
    <meta name="author" content="Marc Scheimann" />
    <meta
      name="description"
      content="JU-DO-KON! A web-based judo-themed card battle game featuring elite judoka."
    />
    <meta property="og:title" content="JU-DO-KON!" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://cyanautomation.github.io/judokon/" />
    <meta
      property="og:description"
      content="JU-DO-KON! A web-based judo-themed card battle game featuring elite judoka."
    />
    <meta name="theme-color" content="#22223b" />
    <title>Ju-Do-Kon!</title>
    <link rel="preload" href="../styles.css" as="style" />
    <link rel="stylesheet" href="../styles.css" />
    <link rel="icon" type="image/png" href="../assets/images/favicon.ico" />
  </head>

  <body>
    <header class="header">
      <div class="character-slot left"></div>
      <div class="logo-container">
        <a href="../index.html">
          <img src="../assets/images/judokonLogoSmall.png" alt="JU-DO-KON! Logo" class="logo" />
        </a>
      </div>
      <div class="character-slot right"></div>
    </header>

    <main class="container" role="main">
      <section id="quote-container" class="quote-container">
        <div class="kg-sprite">
          <img
            src="../assets/helperKG/helperKG1.png"
            alt="KG character congratulating the player"
          />
        </div>
        <div
          id="quote"
          class="quote"
          aria-labelledby="quote-heading"
          aria-describedby="quote-content"
        ></div>
      </section>
    </main>

    <footer>
      <nav class="bottom-navbar">
        <ul>
          <li><a href="randomJudoka.html">View Judoka</a></li>
          <li><a href="updateJudoka.html">Update Judoka</a></li>
          <li><a href="battleJudoka.html">Battle!</a></li>
        </ul>
      </nav>
    </footer>

    <noscript>
      <p class="noscript-warning">
        JU-DO-KON! requires JavaScript to run. Please enable JavaScript to play.
      </p>
    </noscript>

    <script nomodule>
      alert(
        "Your browser does not support modern JavaScript. Please update your browser to play JU-DO-KON!"
      );
    </script>
    <script>
      async function displayRandomQuote() {
        try {
          // Fetch the JSON data
          const response = await fetch("../data/aesopsFables.json");
          if (!response.ok) {
            throw new Error("Failed to fetch aesopsFables.json");
          }
          const fables = await response.json();

          // Get the highest ID
          const maxId = Math.max(...fables.map((fable) => fable.id));

          // Generate a random ID
          const randomId = Math.floor(Math.random() * maxId) + 1;

          // Find the fable with the random ID
          const randomFable = fables.find((fable) => fable.id === randomId);

          // Display the title and story in the quote div
          const quoteDiv = document.getElementById("quote");
          if (randomFable) {
            // Convert \n\n into paragraphs and handle single \n for line breaks
            const formattedStory = randomFable.story
              .replace(/\\n\\n/g, "</p><p><br>") // Replace double \n with paragraph breaks
              .replace(/\\n/g, "<br>"); // Replace single \n with line breaks

            quoteDiv.innerHTML = `
              <div class="quote-heading" id="quote-heading">${randomFable.title}</div>
              <div class="quote-content" id="quote-content"><p>${formattedStory}</p></div>
            `;
          } else {
            quoteDiv.innerHTML = "<p>Well done, congratulations!</p>";
          }
        } catch (error) {
          console.error("Error fetching or displaying the fable:", error);
          const quoteDiv = document.getElementById("quote");
          quoteDiv.innerHTML = "<p>Well done, congratulations!</p>";
        }
      }

      // Call the function when the page loads
      document.addEventListener("DOMContentLoaded", displayRandomQuote);
    </script>
  </body>
</html>
