{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Client Embeddings Array",
  "description": "A JSON array of semantic embeddings for RAG document search. Root must be an array (not an object with an 'embeddings' property). Each entry is an embedding object with semantic vector and metadata.",
  "type": "array",
  "minItems": 1,
  "items": {
    "type": "object",
    "required": ["id", "text", "embedding", "source"],
    "properties": {
      "id": {
        "type": "string",
        "description": "Unique identifier for this embedding entry"
      },
      "text": {
        "type": "string",
        "description": "The text content that was embedded"
      },
      "embedding": {
        "type": "array",
        "items": {
          "type": "number"
        },
        "minItems": 1,
        "description": "Vector representation (typically 384 dimensions for MiniLM-L6-v2)"
      },
      "source": {
        "type": "string",
        "description": "Source file path (relative path in repository)"
      },
      "tags": {
        "type": "array",
        "items": {
          "type": "string"
        },
        "description": "Semantic tags for categorization (e.g., 'prd', 'battle', 'judoka-data')"
      },
      "sparseVector": {
        "type": "object",
        "additionalProperties": {
          "type": "number"
        },
        "description": "Sparse vector representation for hybrid search"
      },
      "metadata": {
        "type": "object",
        "description": "Additional metadata about the embedding entry",
        "properties": {
          "construct": {
            "type": "string",
            "description": "Type of construct (function, class, section, etc.)"
          },
          "role": {
            "type": "string",
            "enum": ["definition", "implementation", "documentation", "test"],
            "description": "Role or context of the content"
          },
          "patterns": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Code or design patterns referenced"
          },
          "relations": {
            "type": "object",
            "properties": {
              "imports": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Module/function imports referenced"
              },
              "calls": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Functions or methods called"
              }
            }
          }
        }
      },
      "contextPath": {
        "type": "string",
        "description": "Path or context breadcrumb for navigation"
      },
      "qaContext": {
        "type": "string",
        "description": "Optional short summary or Q&A context derived from text"
      },
      "version": {
        "type": "integer",
        "minimum": 1,
        "description": "Schema version for this embedding entry"
      }
    }
  }
}
