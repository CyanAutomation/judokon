<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="JU-DO-KON! Classic Battle – CLI mode" />
    <title>JU-DO-KON! – Classic Battle CLI</title>
    <style>
      :root {
        color-scheme: light dark;
      }
      html,
      body {
        height: 100%;
        margin: 0;
      }
      body {
        font-family:
          ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New",
          monospace;
        background: #0b0c0c;
        color: #f2f2f2;
      }
      .cli-root {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      .cli-header {
        padding: 8px 12px;
        border-bottom: 1px solid #3a3a3a;
        display: flex;
  align-items: center;
        justify-content: space-between;
        min-width: 18ch; /* reserve width for longest state (prevents wrap/jump) */
        box-sizing: border-box; /* include padding in fixed height */
        height: 56px; /* hard cap header height for consistency */
      }
      .cli-title {
        font-weight: 700;
      }
      /* Reserve visible space for countdown even when empty */
      #cli-countdown {
        min-height: 1.2em;
      }
      .state-badge {
        font-size: 12px;
        opacity: 0.8;
        margin-left: 8px;
        /* Reserve vertical space for stat rows to avoid layout shift when populated */
        min-height: 8rem;
      }
      .cli-stat {
        padding: 4px 6px;
        background: #121212;
        border: 1px solid #3a3a3a;
        min-height: 2.4em;
        display: flex;
        align-items: center;
        gap: 8px;
        align-items: center;
      }
      .cli-main {
        flex: 1;
        display: flex;
        width: 100%;
        max-width: none;
        margin: 0;
        flex-direction: column;
        padding: 12px 16px;
        gap: 12px;
      }
      /* Retro theme: green-on-black optional class */
      .cli-retro {
        background: #000 !important;
        color: #8cff6b !important;
      }
      .cli-retro a {
        color: #8cff6b;
      }
      .cli-retro .cli-stat.selected {
        border-color: #8cff6b;
      }
      .cli-block {
        padding: 8px 10px;
        border: 1px solid #333;
        background: #0f0f0f;
        border-radius: 6px;
      }
      .cli-settings {
        background: #0d0d0d;
        color: #cfcfcf;
        font-size: 13px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .cli-settings-row {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
      }
      /* ASCII separators to mimic terminal panes */
      .ascii-sep {
        font-family: inherit;
        color: inherit;
        padding: 4px 0;
      }
      /* Reserve space for round message to prevent layout jump */
      #round-message {
        min-height: 1.4em; /* ~1 line of monospace text */
      }
      /* Make verbose section scrollable so newest entries are visible */
      #cli-verbose-log {
        max-height: 35vh;
        overflow-y: auto;
      }
      #cli-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 8px;
      }
      .cli-stat {
        padding: 4px 6px;
        background: #121212;
        border: 1px solid #3a3a3a;
      }
      .cli-stat.selected {
        border-color: #9ad1ff;
        background: #1a1a1a;
      }
      .cli-controls {
        /* make controls lay out horizontally and center-aligned */
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .cli-status {
        /* keep the status block aligned to the right and vertically centered in header */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-end;
        text-align: right;
        white-space: pre;
        gap: 2px;
      }
      .cli-status > div {
        line-height: 1;
        font-size: 14px;
        margin: 0;
        padding: 0;
      }
      #cli-help {
        margin: 0;
        padding-left: 16px;
      }
      .cli-footer {
        margin-top: auto;
        border-top: 1px solid #3a3a3a;
      }
      #cli-controls-hint {
        position: relative;
        z-index: 2;
        padding: 4px 12px;
        font-size: 12px;
        text-align: center;
        background: #0b0c0c;
        color: #e6e6e6;
        opacity: 0.8;
      }
      /* Terminal-style snackbar line at the bottom */
      #snackbar-container {
        padding: 8px 12px;
        background: #111;
        color: #e6e6e6;
      }
      #snackbar-container .snackbar {
        display: block;
      }
      /* Floating help panel */
      #cli-shortcuts {
        position: fixed;
        top: 56px;
        right: 12px;
        background: #0b0c0c;
        z-index: 1;
        max-width: 260px;
      }
      #cli-shortcuts-close {
        float: right;
        background: none;
        border: 0;
        color: #f2f2f2;
        cursor: pointer;
        font-size: 16px;
      }
      /* Ensure good contrast for links if any appear */
      a {
        color: #9ad1ff;
      }
      a:focus,
      button:focus,
      input:focus,
      select:focus,
      [tabindex]:focus {
        outline: 2px solid #9ad1ff;
        outline-offset: 2px;
      }
      .skip-link {
        position: absolute;
        top: -40px;
        left: 0;
        background: #0b0c0c;
        color: #f2f2f2;
        padding: 8px;
      }
      .skip-link:focus {
        top: 0;
      }
      #start-match-button {
        background: transparent;
        border: 1px solid #9ad1ff;
        color: #9ad1ff;
        padding: 8px 12px;
        font-family: inherit;
        cursor: pointer;
        font-size: 1em;
      }

      #start-match-button:hover,
      #start-match-button:focus {
        background: #1a1a1a;
        outline: 2px solid #9ad1ff;
        outline-offset: 2px;
      }

      /* Responsive tweaks: improve header wrapping and control spacing on narrow screens */
      @media (max-width: 720px) {
        .cli-header {
          flex-direction: column;
          align-items: stretch;
          height: auto;
          gap: 8px;
          padding: 10px;
        }
        .cli-title {
          margin-bottom: 4px;
          font-size: 15px;
        }
        .cli-controls {
          flex-wrap: wrap;
          gap: 6px;
          align-items: center;
        }
        .cli-controls label {
          min-width: 6ch;
          font-size: 13px;
        }
        .cli-status {
          flex-direction: row;
          align-items: center;
          justify-content: space-between;
          gap: 12px;
          margin-top: 4px;
        }
        .cli-status > div {
          font-size: 13px;
          line-height: 1;
        }
        .cli-main {
          padding: 8px;
        }
        #cli-stats {
          grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        }
      }

      @media (max-width: 420px) {
        .cli-controls label {
          display: none; /* keep inputs accessible, hide repetitive labels to save space */
        }
        .cli-controls input,
        .cli-controls select {
          min-width: 5ch;
        }
        #cli-score {
          font-size: 12px;
        }
      }
    </style>
  </head>
  <body>
    <a href="#cli-main" class="skip-link">Skip to main content</a>
    <div id="cli-root" class="cli-root" data-round="0" data-test="cli-root">
      <header id="cli-header" class="cli-header" role="banner">
        <div class="cli-title">
          <a href="../../index.html" data-testid="home-link" aria-label="Return to home">Home</a>
          &nbsp;|&nbsp; Classic Battle (CLI)
          <span
            id="battle-state-badge"
            data-flag="battleStateBadge"
            class="state-badge"
            aria-live="polite"
            style="display: none"
            >State: —</span
          >
        </div>
  <!-- header title + status only; controls moved into main.settings for less prominence -->
        <div class="cli-status" aria-live="polite" aria-atomic="true">
          <div id="cli-round">Round 0 of 0</div>
          <div id="cli-score" data-score-player="0" data-score-opponent="0" data-test="cli-score">
            You: 0 Opponent: 0
          </div>
        </div>
  </header>

      <main id="cli-main" class="cli-main" role="main">
        <section aria-label="Round Status" class="cli-block">
          <div id="round-message" role="status" aria-live="polite" aria-atomic="true"></div>
          <div id="cli-countdown" role="status" aria-live="polite" data-remaining-time="0"></div>
        </section>

        <!-- Less-prominent settings section moved into main to reduce header prominence -->
        <section aria-label="Match Settings" class="cli-block cli-settings">
          <div class="cli-settings-header" style="display:flex;align-items:center;justify-content:space-between;">
            <div style="font-weight:600">Match Settings</div>
            <div>
              <button id="cli-settings-toggle" aria-expanded="true" aria-controls="cli-settings-body" style="background:transparent;border:0;color:inherit;cursor:pointer;font-family:inherit">Settings ▾</button>
            </div>
          </div>
          <div id="cli-settings-body">
            <div class="cli-settings-row">
              <label for="points-select">Win target:</label>
              <select id="points-select" aria-label="Points to win" data-tooltip-id="settings.pointsToWin">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="15">15</option>
              </select>
            </div>
            <div class="cli-settings-row">
              <label for="verbose-toggle">Verbose:</label>
              <input id="verbose-toggle" type="checkbox" aria-label="Toggle verbose logging" data-flag="cliVerbose" />
              <label for="retro-toggle">Retro:</label>
              <input id="retro-toggle" type="checkbox" aria-label="Toggle retro theme" data-flag="cliRetro" />
            </div>
            <div class="cli-settings-row">
              <label for="seed-input">Seed:</label>
              <input id="seed-input" type="number" inputmode="numeric" aria-label="Deterministic seed (optional)" style="width: 6ch" />
            </div>
          </div>
        </section>

        <section aria-label="Stat Selection" class="cli-block">
          <div
            id="cli-stats"
            role="listbox"
            tabindex="0"
            aria-label="Select a stat with number keys 1–5"
          >
            <!-- Skeleton placeholders to stabilize layout and tests -->
            <div class="cli-stat skeleton">(1) —: —</div>
            <div class="cli-stat skeleton">(2) —: —</div>
            <div class="cli-stat skeleton">(3) —: —</div>
            <div class="cli-stat skeleton">(4) —: —</div>
            <div class="cli-stat skeleton">(5) —: —</div>
          </div>
        </section>

        <section
          aria-label="Shortcuts"
          id="cli-shortcuts"
          class="cli-block"
          data-flag="cliShortcuts"
          hidden
        >
          <button id="cli-shortcuts-close" aria-label="Close help">×</button>
          <ul id="cli-help" style="clear: both">
            <li>[1–5] Select Stat</li>
            <li>[Enter]/[Space] Next</li>
            <li>[Q] Quit</li>
            <li>[H] Toggle Help</li>
          </ul>
        </section>

        <section
          aria-label="Verbose Log"
          id="cli-verbose-section"
          class="cli-block"
          data-flag="cliVerbose"
          hidden
        >
          <pre
            id="cli-verbose-log"
            aria-live="polite"
            aria-atomic="false"
            style="margin: 0; white-space: pre-wrap"
          ></pre>
        </section>
      </main>

      <footer class="cli-footer" role="contentinfo">
        <div id="cli-controls-hint" aria-hidden="true">
          [1–5] Stats · [Enter/Space] Next · [H] Help · [Q] Quit
        </div>
        <!-- Terminal-style snackbar container anchored at the bottom -->
        <div id="snackbar-container">
          <!-- snackbar.js will populate .snackbar elements here; in CLI this renders as a single bottom line. -->
        </div>
      </footer>
      <!-- Hidden containers for compatibility with classic battle DOM queries -->
      <div id="player-card" style="display: none"></div>
      <div id="opponent-card" style="display: none"></div>
      <div id="modal-container"></div>
      <script type="module" src="../pages/battleCLI.init.js"></script>
      <script type="module" src="../pages/battleCLI.js"></script>
    </div>
  </body>
</html>
